<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="robots" content="none" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Open IP-KVM</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="./style.css" />
  </head>

  <body>
    <div id="app">
      <div v-show="streamSrc" style="display: none">

        <img
          v-if="enableMjpeg"
          :src="streamSrc"
          @focus="onScreenFocus"
          @blur="onScreenBlur"
          @mousemove="onScreenMouseMove"
          @mouseup="onScreenMouseUp"
          @mousedown="onScreenMouseDown"
          @wheel="onScreenMouseWheel"
          class="screen"
          tabindex="1"
        />
        <video class="screen" id="webrtc-output" v-if="enableVideo" :src="streamSrc" playsinline></video>

        <div class="float-zone trans-bg">
          <!-- <div>Open IP-KVM</div> -->
          <span
            class="indicator bi-mouse"
            style="font-size: 22px"
            :class="{active: isPointorLocked}"
            title="Mouse Indicator"
          ></span>
          <span
            class="indicator bi-keyboard"
            style="font-size: 26px"
            :class="{active: isKeyCaptureActive}"
            title="Keyboard Indicator"
          ></span>
          <span
            @click="setDialog('paste')"
            class="button bi-clipboard-data"
            title="Remote Paste (ASCII Only)"
          ></span>
          <span
            @click="lockEscapeKey"
            class="button"
            title="全屏"
            :class="[fullScreen ? 'bi-fullscreen-exit' : 'bi-fullscreen']"
          ></span>
          <span
            @click="setDialog('help')"
            class="button bi-question-circle"
            title="Help"
          ></span>
        </div>

        <div v-show="activeDialog === 'help'" class="dialog trans-bg">
          <div class="dialog-header">Help</div>
          <ul class="auto">
            <li>
              Mouse
              <ul>
                <li>Click anywhere to enter pointer capture mode</li>
                <li>Press <b>ESC</b> to exit</li>
              </ul>
            </li>
            <li>
              Keyboard
              <ul>
                <li>Press <b>Enter</b> to enter key capture mode</li>
                <li>press <b>Shift + ESC</b> to exit</li>
              </ul>
            </li>
            <li>
              Remote Paste
              <ul>
                <li>Quickly input to remote device</li>
                <li>ASCII characters only</li>
              </ul>
            </li>
          </ul>
          <div class="dialog-footer">
            <button class="dialog-btn" @click="setDialog()">OK</button>
          </div>
        </div>

        <div v-show="activeDialog === 'paste'" class="dialog trans-bg">
          <div class="dialog-header">Remote Paste</div>
          <textarea
            v-model="pasteContent"
            class="remote-paste-textarea"
          ></textarea>
          <div class="dialog-footer">
            <button class="dialog-btn" @click="setDialog(), doRemotePaste()">
              Paste
            </button>
            <button class="dialog-btn" @click="setDialog()">Cancel</button>
          </div>
        </div>

        <div v-show="activeDialog === 'escaped'" class="dialog trans-bg">
          <div class="dialog-header">按下了Escape键</div>
          <section class="auto">
            <p>您似乎按下了Escape键. 对于浏览器来说, 当按下Escape键时, 将会自动退出鼠标捕获模式. 这时您会发现无法使用鼠标操作远程计算机</p>
            <p>Chrome/Edge浏览器提供了一种新的特性, 当您进入"全屏模式"时, 可以避免网页响应Escape键.</p>
            <p>如果您想使用该特性, 请点击下方的"进入全屏模式"按钮.</p>
            <input class="form-check-input" type="checkbox" id="checkbox" v-model="ignoreEscapedDialog" />
            <label class="form-check-label" for="checkbox">我已知晓, 不再弹出</label>
          </section>
          <div class="dialog-footer">
            <button class="dialog-btn" @click="setDialog(), lockEscapeKey()">
              进入全屏模式
            </button>
            <button class="dialog-btn" @click="setDialog()">取消</button>
          </div>
        </div>

      </div>

      <div v-show="!streamSrc" class="loading">Loading...</div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.13/dist/vue.min.js"></script>

    <script type="module" src="./app.mjs"></script>

    <script nomodule>
      alert('Opps, no es module support');
    </script>
  </body>
</html>
